"0","# Create variable for year on year change for each district"
"0","state_deltas <- states %>% "
"0","  group_by(State) %>% "
"0","  mutate(delta = score - lag(score, order_by = year)) %>%"
"0","  mutate(delta_lagged = lag(delta, order_by = year), delta_dbl_lag = lag(delta,n=2, order_by = year)) %>%"
"0","  arrange(State, year)"
"0",""
"0",""
"0","# Calculate average autocorrelation of delta"
"0","corr_state_deltas <- state_deltas %>% "
"0","  filter(year >= 2008) %>% "
"0","  summarise(auto = cor(delta, delta_lagged, use = ""pairwise.complete.obs"")) %>%"
"0","  ungroup() %>%"
"0","  summarise(mean_auto=mean(auto)) %>% .$mean_auto"
"2","`summarise()` ungrouping output (override with `.groups` argument)
"
"0","# Calculate correlation betwen delta letters and delta letters lagged for entire dataset (without first calculating for each state and then averaging)."
"0","# this should be about the same as when we first calculate for each state and then average --> which it is."
"0","check_corr_state_deltas <- state_deltas %>% filter(year >= 2008) %>%"
"0","  ungroup() %>%"
"0","  summarize(auto =cor(delta,delta_lagged, use = ""pairwise.complete.obs"")) %>%"
"0","  .$auto"
"0",""
"0",""
"0","# calculate the variance of the deltas"
"0","var_state_deltas <- var(state_deltas$delta, na.rm = TRUE)"
"0",""
"0","# calculate the variance of the levels"
"0","var_state_levels <- var(state_deltas$score, na.rm = TRUE)"
"0",""
"0","# calculate variance of transitory component"
"0","var_state_epsilon <- -corr_state_deltas*var_state_deltas"
"0",""
