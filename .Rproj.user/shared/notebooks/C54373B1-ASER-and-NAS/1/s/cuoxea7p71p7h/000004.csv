"0","# Calculate ICC"
"0","icc_df <- ihds %>% "
"0","  filter(!is.na(TA8B) & (TA4 >= 2 & TA4 <= 5) & (URBAN2011 == 0))"
"0","# ICCest(x = psu_expanded, y = TA8B, data = icc_df)"
"0",""
"0","# Verify this by calculating the ICC manually from the ANOVA table"
"0","fit <- lm(TA8B~psu_expanded, data = icc_df)"
"0","ms_between <- anova_est$meansq[anova_est$term == ""psu_expanded""]"
"0","ms_resid <- anova_est$meansq[anova_est$term == ""Residuals""]"
"0",""
"0","# get average number of children per village"
"0","k <- icc_df %>% count(psu_expanded) %>% summarize(mean(n))"
"0","k <- k[[1,1]]"
"0",""
"0","icc <- (ms_between - ms_resid)/(ms_between+(k-1)*ms_resid)"
"0","print(icc)"
"1","[1]"
"1"," 0.1860436"
"1","
"
